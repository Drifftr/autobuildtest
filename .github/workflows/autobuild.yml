name: Auto Build Action Test
"on":
  workflow_dispatch:
    inputs:
      configurables:
        description: configurables list json
        required: true
        default: N/A
jobs:
  build:
    runs-on: ubuntu-latest
    env:
      TEMPLATE: service
      ORG_NAME: heshithahettihewa
      MODULE_NAME: autobuildtest
      CONFIG_INPUT: sdas
    container:
      image: ballerina/ballerina:2201.1.1
      options: --user root
    steps:
      - name: Checkout Source Code
        uses: actions/checkout@v2
      - name: Choreo Toml Parser
        uses: choreo-templates/ballerina-toml-parser@v2
        with:
          type: read
      - name: Ballerina Build
        run: |
          bal build --sticky --export-openapi --generate-config-schema
      - run: pwd
      - name: Prepare Python Script
        run: echo 'ewogICAgImpzb25TY2hlbWEiOiAiZXdvZ0lDSWtjMk5vWlcxaElqb2dJbWgwZEhBNkx5OXFjMjl1TFhOamFHVnRZUzV2Y21jdlpISmhablF0XG5NRGN2YzJOb1pXMWhJeUlzQ2lBZ0luUjVjR1VpT2lBaWIySnFaV04wSWl3S0lDQWljSEp2Y0dWeWRHbGxcbmN5STZJSHNLSUNBZ0lDSm9aWE5vYVhSb1lXaGxkSFJwYUdWM1lTSTZJSHNLSUNBZ0lDQWdJblI1Y0dVaVxuT2lBaWIySnFaV04wSWl3S0lDQWdJQ0FnSW5CeWIzQmxjblJwWlhNaU9pQjdDaUFnSUNBZ0lDQWdJbVJsXG5abUYxYkhSZmQyVmlhRzl2YTE5M2R5STZJSHNLSUNBZ0lDQWdJQ0FnSUNKMGVYQmxJam9nSW05aWFtVmpcbmRDSXNDaUFnSUNBZ0lDQWdJQ0FpY0hKdmNHVnlkR2xsY3lJNklIc0tJQ0FnSUNBZ0lDQWdJQ0FnSW1OdlxuYm1acFp5STZJSHNLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWlkSGx3WlNJNklDSnZZbXBsWTNRaUxBb2dJQ0FnXG5JQ0FnSUNBZ0lDQWdJQ0p3Y205d1pYSjBhV1Z6SWpvZ2V3b2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0luVnpcblpYSnVZVzFsSWpvZ2V3b2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWlkSGx3WlNJNklDSnpkSEpwYm1jaVxuQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0I5TEFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSW5CaGMzTjNiM0prXG5Jam9nZXdvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBaWRIbHdaU0k2SUNKemRISnBibWNpQ2lBZ0lDQWdcbklDQWdJQ0FnSUNBZ0lDQjlMQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJbU5vWVc1dVpXeE9ZVzFsSWpvZ1xuZXdvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBaWRIbHdaU0k2SUNKemRISnBibWNpQ2lBZ0lDQWdJQ0FnXG5JQ0FnSUNBZ0lDQjlMQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJbkpsY0d4aGVVWnliMjBpT2lCN0NpQWdcbklDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNKMGVYQmxJam9nSW1sdWRHVm5aWElpQ2lBZ0lDQWdJQ0FnSUNBZ1xuSUNBZ0lDQjlMQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJbVZ1ZG1seWIyNXRaVzUwSWpvZ2V3b2dJQ0FnXG5JQ0FnSUNBZ0lDQWdJQ0FnSUNBaWRIbHdaU0k2SUNKemRISnBibWNpQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdcbklDQjlDaUFnSUNBZ0lDQWdJQ0FnSUNBZ2ZTd0tJQ0FnSUNBZ0lDQWdJQ0FnSUNBaVlXUmthWFJwYjI1aFxuYkZCeWIzQmxjblJwWlhNaU9pQm1ZV3h6WlN3S0lDQWdJQ0FnSUNBZ0lDQWdJQ0FpY21WeGRXbHlaV1FpXG5PaUJiQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FpZFhObGNtNWhiV1VpTEFvZ0lDQWdJQ0FnSUNBZ0lDQWdcbklDQWdJbkJoYzNOM2IzSmtJaXdLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0pqYUdGdWJtVnNUbUZ0WlNJc1xuQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FpY21Wd2JHRjVSbkp2YlNJc0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnXG5JQ0FpWlc1MmFYSnZibTFsYm5RaUNpQWdJQ0FnSUNBZ0lDQWdJQ0FnWFN3S0lDQWdJQ0FnSUNBZ0lDQWdcbklDQWlibUZ0WlNJNklDSmlZV3hzWlhKcGJtRjRMM1J5YVdkblpYSXVjMkZzWlhObWIzSmpaVG93TGpRdVxuTURwTWFYTjBaVzVsY2tOdmJtWnBaeUlzQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJbVJsYzJOeWFYQjBhVzl1XG5Jam9nSWlJS0lDQWdJQ0FnSUNBZ0lDQWdmUW9nSUNBZ0lDQWdJQ0FnZlN3S0lDQWdJQ0FnSUNBZ0lDSmhcblpHUnBkR2x2Ym1Gc1VISnZjR1Z5ZEdsbGN5STZJR1poYkhObExBb2dJQ0FnSUNBZ0lDQWdJbkpsY1hWcFxuY21Wa0lqb2dXd29nSUNBZ0lDQWdJQ0FnSUNBaVkyOXVabWxuSWdvZ0lDQWdJQ0FnSUNBZ1hRb2dJQ0FnXG5JQ0FnSUgwS0lDQWdJQ0FnZlN3S0lDQWdJQ0FnSW1Ga1pHbDBhVzl1WVd4UWNtOXdaWEowYVdWeklqb2dcblptRnNjMlVLSUNBZ0lIMEtJQ0I5TEFvZ0lDSmhaR1JwZEdsdmJtRnNVSEp2Y0dWeWRHbGxjeUk2SUdaaFxuYkhObENuMEtcbiIsCiAgICAiY29uZmlndXJhdGlvbk1vdW50IjogWwogICAgICAgIHsKICAgICAgICAgICAgImNvbmZpZ0tleU5hbWUiOiAiY29uZmlnLnVzZXJuYW1lIiwKICAgICAgICAgICAgInZhbHVlVHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAicGFyZW50T2JqZWN0VHlwZSI6ICJiYWxsZXJpbmF4L3RyaWdnZXIuc2FsZXNmb3JjZTowLjQuMDpMaXN0ZW5lckNvbmZpZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgImNvbmZpZ0tleU5hbWUiOiAiY29uZmlnLnBhc3N3b3JkIiwKICAgICAgICAgICAgInZhbHVlVHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAicGFyZW50T2JqZWN0VHlwZSI6ICJiYWxsZXJpbmF4L3RyaWdnZXIuc2FsZXNmb3JjZTowLjQuMDpMaXN0ZW5lckNvbmZpZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgImNvbmZpZ0tleU5hbWUiOiAiY29uZmlnLmNoYW5uZWxOYW1lIiwKICAgICAgICAgICAgInZhbHVlVHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAiaXNSZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAgICJwYXJlbnRPYmplY3RUeXBlIjogImJhbGxlcmluYXgvdHJpZ2dlci5zYWxlc2ZvcmNlOjAuNC4wOkxpc3RlbmVyQ29uZmlnIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiY29uZmlnS2V5TmFtZSI6ICJjb25maWcucmVwbGF5RnJvbSIsCiAgICAgICAgICAgICJ2YWx1ZVR5cGUiOiAiaW50ZWdlciIsCiAgICAgICAgICAgICJwYXJlbnRPYmplY3RUeXBlIjogImJhbGxlcmluYXgvdHJpZ2dlci5zYWxlc2ZvcmNlOjAuNC4wOkxpc3RlbmVyQ29uZmlnIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiY29uZmlnS2V5TmFtZSI6ICJjb25maWcuZW52aXJvbm1lbnQiLAogICAgICAgICAgICAidmFsdWVUeXBlIjogInN0cmluZyIsCiAgICAgICAgICAgICJpc1JlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICAgInBhcmVudE9iamVjdFR5cGUiOiAiYmFsbGVyaW5heC90cmlnZ2VyLnNhbGVzZm9yY2U6MC40LjA6TGlzdGVuZXJDb25maWciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJjb25maWdLZXlOYW1lIjogImNvbmZpZzIiLAogICAgICAgICAgICAidmFsdWVUeXBlIjogInN0cmluZyIsCiAgICAgICAgICAgICJpc1JlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICAgInBhcmVudE9iamVjdFR5cGUiOiAiYmFsbGVyaW5heC90cmlnZ2VyLnNhbGVzZm9yY2U6MC40LjA6TGlzdGVuZXJDb25maWciCiAgICAgICAgfQogICAgICAgIAogICAgXQp9' | base64 -d > input.json
      - name: Run Python Script
        if: ${{ env.CONFIG_INPUT }}
        run: apk add --update --no-cache python3 && ln -sf python3 /usr/bin/python && echo 'aW1wb3J0IGpzb24KaW1wb3J0IG9zCiAgCiNDYW4gcmVtb3ZlCmYgPSBvcGVuKCdpbnB1dC5qc29uJykKb3MuZW52aXJvblsnQ09ORklHX0lOUFVUJ10gPSBmLnJlYWQoKQpvcy5lbnZpcm9uWydPUkdfTkFNRSddID0gImhlc2hpdGhhaGV0dGloZXdhIgpvcy5lbnZpcm9uWydNT0RVTEVfTkFNRSddID0gImRlZmF1bHRfd2ViaG9va193dyIKZi5jbG9zZSgpCiMjIyMjIyMjCgpjb25maWdTY2hlbWEgPSBvcGVuKCd0YXJnZXQvYmluL2NvbmZpZy1zY2hlbWEuanNvbicpCmRhdGFGID0gb3MuZ2V0ZW52KCdDT05GSUdfSU5QVVQnKQpkYXRhID0ganNvbi5sb2FkcyhkYXRhRikKb3JnTmFtZSA9IG9zLmdldGVudignT1JHX05BTUUnKQptb2R1bGVOYW1lID0gb3MuZ2V0ZW52KCdNT0RVTEVfTkFNRScpCgpjb25maWdTY2hlbWFEYXRhID0ganNvbi5sb2FkKGNvbmZpZ1NjaGVtYSkKY29uZmlndXJhYmxlRGF0YSA9IGNvbmZpZ1NjaGVtYURhdGFbJ3Byb3BlcnRpZXMnXVtvcmdOYW1lXVsncHJvcGVydGllcyddW21vZHVsZU5hbWVdWydwcm9wZXJ0aWVzJ10KCmNvbmZpZ05hbWVzPVtdCmZvciBpIGluIGRhdGFbJ2NvbmZpZ3VyYXRpb25Nb3VudCddOgogICAgY29uZmlnTmFtZXMuYXBwZW5kKHsna2V5JzppWydjb25maWdLZXlOYW1lJ10sICd0eXBlJzogaVsidmFsdWVUeXBlIl19KQoKY29uZmlnU2NoZW1hLmNsb3NlKCkKCmRlZiBvYmpFeGlzdHNJbkFycmF5KGlucHV0T2JqLCBpbnB1dEFycmF5KToKICAgIHJlc3VsdCA9IEZhbHNlCiAgICBmb3IgaSBpbiBpbnB1dEFycmF5OgogICAgICAgIGlmKCBpbnB1dE9ialsna2V5J10gPT0gaVsna2V5J10gYW5kIGlucHV0T2JqWyd0eXBlJ10gPT0gaVsndHlwZSddICk6CiAgICAgICAgICAgIHJlc3VsdCA9IFRydWUKICAgIHJldHVybiByZXN1bHQKCmRlZiBhcnJheUNvbXBhcmUoYSwgYik6CiAgICByZXN1bHQgPSBUcnVlCiAgICBmb3IgaSBpbiBhOgogICAgICAgIGlmKG5vdCBvYmpFeGlzdHNJbkFycmF5KGksIGIpKToKICAgICAgICAgICAgcmVzdWx0ID0gRmFsc2UKICAgICAgICAgICAgYnJlYWsKICAgIGZvciBqIGluIGI6CiAgICAgICAgaWYobm90IG9iakV4aXN0c0luQXJyYXkoaiwgYSkpOgogICAgICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgICAgICBicmVhawogICAgcmV0dXJuIHJlc3VsdAoKZGVmIGZsYXR0ZW5TY2hlbWEoZCwga2V5LCBkb3RzKToKCiAgICBpZiBpc2luc3RhbmNlKGQsIGRpY3QpOgogICAgICAgIGZvciBrIGluIGQ6CiAgICAgICAgICAgIGlmICgncHJvcGVydGllcycgaW4gZFtrXSk6CiAgICAgICAgICAgICAgICBmbGF0dGVuU2NoZW1hKGRba11bJ3Byb3BlcnRpZXMnXSwga2V5ICsgJy4nICsgayBpZiBrZXkgZWxzZSBrLCBkb3RzKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdmFsID0gJycKICAgICAgICAgICAgICAgIGlmKCBpc2luc3RhbmNlKGRba10sIGRpY3QpKToKICAgICAgICAgICAgICAgICAgICB2YWwgPSAnLicgKyBrIGlmIGtleSBlbHNlIGsKICAgICAgICAgICAgICAgIGZsYXR0ZW5TY2hlbWEoZFtrXSwga2V5ICsgdmFsLCBkb3RzKQogICAgZWxzZToKICAgICAgICBkb3RzLmFwcGVuZCh7ImtleSI6a2V5LCAidHlwZSI6ZH0pCgogICAgcmV0dXJuIGRvdHMKCmRvdE5vdCA9IGZsYXR0ZW5TY2hlbWEoY29uZmlndXJhYmxlRGF0YSwgJycsIFtdKQpwcmludChkb3ROb3QpCnByaW50KGFycmF5Q29tcGFyZShjb25maWdOYW1lcyxkb3ROb3QpKQ==' | base64 -d > flowsupport.py && python3 flowsupport.py
        

      
