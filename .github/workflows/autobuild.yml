name: Auto Build Action Test
"on":
  workflow_dispatch:
    inputs:
      configurables:
        description: configurables list json
        required: true
        default: N/A
jobs:
  build:
    runs-on: ubuntu-latest
    env:
      TEMPLATE: service
    container:
      image: ballerina/ballerina:2201.1.1
      options: --user root
    steps:
      - name: Checkout Source Code
        uses: actions/checkout@v2
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - run: type -a python
      - run: which python
      - run: pwd
      - name: Inline python step
        run: |
          import os 
          import json
          import urllib

          def readJson(path) :
            with open(path) as json_file:
              data = json.load(json_file)
              return data
          print(os.environ['PATH'])
          for f in os.listdir("."):
            print(f)
          path = os.environ['GITHUB_EVENT_PATH']
          print('Event path is %s' % path)
          event = readJson(path)
          print(json.dumps(event,indent=2))
          url = event['head_commit']['url']
          print('HEAD is at %s' % url)
        shell: python
      - name: Choreo Toml Parser
        uses: choreo-templates/ballerina-toml-parser@v2
        with:
          type: read
      - name: Ballerina Build
        run: |
          bal build --sticky --export-openapi --generate-config-schema
      - name: Run Python Script
        run: python .github/workflows/flowsupport.py
        

      
