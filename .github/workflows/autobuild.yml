name: Auto Build Action Test
"on":
  workflow_dispatch:
    inputs:
      configurables:
        description: configurables list json
        required: true
        default: N/A
jobs:
  build:
    runs-on: ubuntu-latest
    env:
      TEMPLATE: service
      ORG_NAME: heshithahettihewa
      MODULE_NAME: autobuildtest
      CONFIG_INPUT: sdas
    container:
      image: ballerina/ballerina:2201.1.1
      options: --user root
    steps:
      - name: Checkout Source Code
        uses: actions/checkout@v2
      - name: Choreo Toml Parser
        uses: choreo-templates/ballerina-toml-parser@v2
        with:
          type: read
      - name: Ballerina Build
        run: |
          bal build --sticky --export-openapi --generate-config-schema
      - run: pwd
      - name: Prepare Python Script
        run: echo 'ewogICAgImpzb25TY2hlbWEiOiAiZXdvZ0lDSWtjMk5vWlcxaElqb2dJbWgwZEhBNkx5OXFjMjl1TFhOamFHVnRZUzV2Y21jdlpISmhablF0XG5NRGN2YzJOb1pXMWhJeUlzQ2lBZ0luUjVjR1VpT2lBaWIySnFaV04wSWl3S0lDQWljSEp2Y0dWeWRHbGxcbmN5STZJSHNLSUNBZ0lDSm9aWE5vYVhSb1lXaGxkSFJwYUdWM1lTSTZJSHNLSUNBZ0lDQWdJblI1Y0dVaVxuT2lBaWIySnFaV04wSWl3S0lDQWdJQ0FnSW5CeWIzQmxjblJwWlhNaU9pQjdDaUFnSUNBZ0lDQWdJbVJsXG5abUYxYkhSZmQyVmlhRzl2YTE5M2R5STZJSHNLSUNBZ0lDQWdJQ0FnSUNKMGVYQmxJam9nSW05aWFtVmpcbmRDSXNDaUFnSUNBZ0lDQWdJQ0FpY0hKdmNHVnlkR2xsY3lJNklIc0tJQ0FnSUNBZ0lDQWdJQ0FnSW1OdlxuYm1acFp5STZJSHNLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWlkSGx3WlNJNklDSnZZbXBsWTNRaUxBb2dJQ0FnXG5JQ0FnSUNBZ0lDQWdJQ0p3Y205d1pYSjBhV1Z6SWpvZ2V3b2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0luVnpcblpYSnVZVzFsSWpvZ2V3b2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWlkSGx3WlNJNklDSnpkSEpwYm1jaVxuQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0I5TEFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSW5CaGMzTjNiM0prXG5Jam9nZXdvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBaWRIbHdaU0k2SUNKemRISnBibWNpQ2lBZ0lDQWdcbklDQWdJQ0FnSUNBZ0lDQjlMQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJbU5vWVc1dVpXeE9ZVzFsSWpvZ1xuZXdvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBaWRIbHdaU0k2SUNKemRISnBibWNpQ2lBZ0lDQWdJQ0FnXG5JQ0FnSUNBZ0lDQjlMQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJbkpsY0d4aGVVWnliMjBpT2lCN0NpQWdcbklDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNKMGVYQmxJam9nSW1sdWRHVm5aWElpQ2lBZ0lDQWdJQ0FnSUNBZ1xuSUNBZ0lDQjlMQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJbVZ1ZG1seWIyNXRaVzUwSWpvZ2V3b2dJQ0FnXG5JQ0FnSUNBZ0lDQWdJQ0FnSUNBaWRIbHdaU0k2SUNKemRISnBibWNpQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdcbklDQjlDaUFnSUNBZ0lDQWdJQ0FnSUNBZ2ZTd0tJQ0FnSUNBZ0lDQWdJQ0FnSUNBaVlXUmthWFJwYjI1aFxuYkZCeWIzQmxjblJwWlhNaU9pQm1ZV3h6WlN3S0lDQWdJQ0FnSUNBZ0lDQWdJQ0FpY21WeGRXbHlaV1FpXG5PaUJiQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FpZFhObGNtNWhiV1VpTEFvZ0lDQWdJQ0FnSUNBZ0lDQWdcbklDQWdJbkJoYzNOM2IzSmtJaXdLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0pqYUdGdWJtVnNUbUZ0WlNJc1xuQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FpY21Wd2JHRjVSbkp2YlNJc0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnXG5JQ0FpWlc1MmFYSnZibTFsYm5RaUNpQWdJQ0FnSUNBZ0lDQWdJQ0FnWFN3S0lDQWdJQ0FnSUNBZ0lDQWdcbklDQWlibUZ0WlNJNklDSmlZV3hzWlhKcGJtRjRMM1J5YVdkblpYSXVjMkZzWlhObWIzSmpaVG93TGpRdVxuTURwTWFYTjBaVzVsY2tOdmJtWnBaeUlzQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJbVJsYzJOeWFYQjBhVzl1XG5Jam9nSWlJS0lDQWdJQ0FnSUNBZ0lDQWdmUW9nSUNBZ0lDQWdJQ0FnZlN3S0lDQWdJQ0FnSUNBZ0lDSmhcblpHUnBkR2x2Ym1Gc1VISnZjR1Z5ZEdsbGN5STZJR1poYkhObExBb2dJQ0FnSUNBZ0lDQWdJbkpsY1hWcFxuY21Wa0lqb2dXd29nSUNBZ0lDQWdJQ0FnSUNBaVkyOXVabWxuSWdvZ0lDQWdJQ0FnSUNBZ1hRb2dJQ0FnXG5JQ0FnSUgwS0lDQWdJQ0FnZlN3S0lDQWdJQ0FnSW1Ga1pHbDBhVzl1WVd4UWNtOXdaWEowYVdWeklqb2dcblptRnNjMlVLSUNBZ0lIMEtJQ0I5TEFvZ0lDSmhaR1JwZEdsdmJtRnNVSEp2Y0dWeWRHbGxjeUk2SUdaaFxuYkhObENuMEtcbiIsCiAgICAiY29uZmlndXJhdGlvbk1vdW50IjogWwogICAgICAgIHsKICAgICAgICAgICAgImNvbmZpZ0tleU5hbWUiOiAiY29uZmlnLnVzZXJuYW1lIiwKICAgICAgICAgICAgInZhbHVlVHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAicGFyZW50T2JqZWN0VHlwZSI6ICJiYWxsZXJpbmF4L3RyaWdnZXIuc2FsZXNmb3JjZTowLjQuMDpMaXN0ZW5lckNvbmZpZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgImNvbmZpZ0tleU5hbWUiOiAiY29uZmlnLnBhc3N3b3JkIiwKICAgICAgICAgICAgInZhbHVlVHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAicGFyZW50T2JqZWN0VHlwZSI6ICJiYWxsZXJpbmF4L3RyaWdnZXIuc2FsZXNmb3JjZTowLjQuMDpMaXN0ZW5lckNvbmZpZyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgImNvbmZpZ0tleU5hbWUiOiAiY29uZmlnLmNoYW5uZWxOYW1lIiwKICAgICAgICAgICAgInZhbHVlVHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAiaXNSZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAgICJwYXJlbnRPYmplY3RUeXBlIjogImJhbGxlcmluYXgvdHJpZ2dlci5zYWxlc2ZvcmNlOjAuNC4wOkxpc3RlbmVyQ29uZmlnIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiY29uZmlnS2V5TmFtZSI6ICJjb25maWcucmVwbGF5RnJvbSIsCiAgICAgICAgICAgICJ2YWx1ZVR5cGUiOiAiaW50ZWdlciIsCiAgICAgICAgICAgICJwYXJlbnRPYmplY3RUeXBlIjogImJhbGxlcmluYXgvdHJpZ2dlci5zYWxlc2ZvcmNlOjAuNC4wOkxpc3RlbmVyQ29uZmlnIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiY29uZmlnS2V5TmFtZSI6ICJjb25maWcuZW52aXJvbm1lbnQiLAogICAgICAgICAgICAidmFsdWVUeXBlIjogInN0cmluZyIsCiAgICAgICAgICAgICJpc1JlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICAgInBhcmVudE9iamVjdFR5cGUiOiAiYmFsbGVyaW5heC90cmlnZ2VyLnNhbGVzZm9yY2U6MC40LjA6TGlzdGVuZXJDb25maWciCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJjb25maWdLZXlOYW1lIjogImNvbmZpZzIiLAogICAgICAgICAgICAidmFsdWVUeXBlIjogInN0cmluZyIsCiAgICAgICAgICAgICJpc1JlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICAgInBhcmVudE9iamVjdFR5cGUiOiAiYmFsbGVyaW5heC90cmlnZ2VyLnNhbGVzZm9yY2U6MC40LjA6TGlzdGVuZXJDb25maWciCiAgICAgICAgfQogICAgICAgIAogICAgXQp9' | base64 -d > input.json
      - name: Run Python Script
        if: ${{ env.CONFIG_INPUT }}
        run: apk add --update --no-cache python3 && ln -sf python3 /usr/bin/python && echo 'aW1wb3J0IGpzb24KaW1wb3J0IG9zCiAgCiNDYW4gcmVtb3ZlCmYgPSBvcGVuKCdpbnB1dC5qc29uJykKb3MuZW52aXJvblsnQ09ORklHX0lOUFVUJ10gPSBmLnJlYWQoKQpmLmNsb3NlKCkKIyMjIyMjIyMKCmNvbmZpZ1NjaGVtYSA9IG9wZW4oJ3RhcmdldC9iaW4vY29uZmlnLXNjaGVtYS5qc29uJykKZGF0YUYgPSBvcy5nZXRlbnYoJ0NPTkZJR19JTlBVVCcpCmRhdGEgPSBqc29uLmxvYWRzKGRhdGFGKQpvcmdOYW1lID0gb3MuZ2V0ZW52KCdPUkdfTkFNRScpCm1vZHVsZU5hbWUgPSBvcy5nZXRlbnYoJ01PRFVMRV9OQU1FJykKCmNvbmZpZ1NjaGVtYURhdGEgPSBqc29uLmxvYWQoY29uZmlnU2NoZW1hKQpjb25maWd1cmFibGVEYXRhID0gY29uZmlnU2NoZW1hRGF0YVsncHJvcGVydGllcyddW29yZ05hbWVdWydwcm9wZXJ0aWVzJ11bbW9kdWxlTmFtZV1bJ3Byb3BlcnRpZXMnXQoKY29uZmlnTmFtZXM9W10KZm9yIGkgaW4gZGF0YVsnY29uZmlndXJhdGlvbk1vdW50J106CiAgICBjb25maWdOYW1lcy5hcHBlbmQoeydrZXknOmlbJ2NvbmZpZ0tleU5hbWUnXSwgJ3R5cGUnOiBpWyJ2YWx1ZVR5cGUiXX0pCgpjb25maWdTY2hlbWEuY2xvc2UoKQoKZGVmIG9iakV4aXN0c0luQXJyYXkoaW5wdXRPYmosIGlucHV0QXJyYXkpOgogICAgcmVzdWx0ID0gRmFsc2UKICAgIGZvciBpIGluIGlucHV0QXJyYXk6CiAgICAgICAgaWYoIGlucHV0T2JqWydrZXknXSA9PSBpWydrZXknXSBhbmQgaW5wdXRPYmpbJ3R5cGUnXSA9PSBpWyd0eXBlJ10gKToKICAgICAgICAgICAgcmVzdWx0ID0gVHJ1ZQogICAgcmV0dXJuIHJlc3VsdAoKZGVmIGFycmF5Q29tcGFyZShhLCBiKToKICAgIHJlc3VsdCA9IFRydWUKICAgIGZvciBpIGluIGE6CiAgICAgICAgaWYobm90IG9iakV4aXN0c0luQXJyYXkoaSwgYikpOgogICAgICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgICAgICBicmVhawogICAgZm9yIGogaW4gYjoKICAgICAgICBpZihub3Qgb2JqRXhpc3RzSW5BcnJheShqLCBhKSk6CiAgICAgICAgICAgIHJlc3VsdCA9IEZhbHNlCiAgICAgICAgICAgIGJyZWFrCiAgICByZXR1cm4gcmVzdWx0CgpkZWYgZmxhdHRlblNjaGVtYShkLCBrZXksIGRvdHMpOgoKICAgIGlmIGlzaW5zdGFuY2UoZCwgZGljdCk6CiAgICAgICAgZm9yIGsgaW4gZDoKICAgICAgICAgICAgaWYgKCdwcm9wZXJ0aWVzJyBpbiBkW2tdKToKICAgICAgICAgICAgICAgIGZsYXR0ZW5TY2hlbWEoZFtrXVsncHJvcGVydGllcyddLCBrZXkgKyAnLicgKyBrIGlmIGtleSBlbHNlIGssIGRvdHMpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB2YWwgPSAnJwogICAgICAgICAgICAgICAgaWYoIGlzaW5zdGFuY2UoZFtrXSwgZGljdCkpOgogICAgICAgICAgICAgICAgICAgIHZhbCA9ICcuJyArIGsgaWYga2V5IGVsc2UgawogICAgICAgICAgICAgICAgZmxhdHRlblNjaGVtYShkW2tdLCBrZXkgKyB2YWwsIGRvdHMpCiAgICBlbHNlOgogICAgICAgIGRvdHMuYXBwZW5kKHsia2V5IjprZXksICJ0eXBlIjpkfSkKCiAgICByZXR1cm4gZG90cwoKZG90Tm90ID0gZmxhdHRlblNjaGVtYShjb25maWd1cmFibGVEYXRhLCAnJywgW10pCnByaW50KGRvdE5vdCkKcHJpbnQoYXJyYXlDb21wYXJlKGNvbmZpZ05hbWVzLGRvdE5vdCkp=' | base64 -d > flowsupport.py && python3 flowsupport.py
        

      
